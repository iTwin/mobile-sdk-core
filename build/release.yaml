trigger: none
pr: none

variables:
  - name: shouldPublish
    value: true

resources:
  repositories:
    - repository: mobile-sdk-ios
      type: github
      name: iTwin/mobile-sdk-ios
      ref: main
      endpoint: iModelJs
    - repository: mobile-ui-react
      type: github
      name: iTwin/mobile-ui-react
      ref: main
      endpoint: iModelJs
    - repository: mobile-samples
      type: github
      name: iTwin/mobile-samples
      ref: main
      endpoint: iModelJs


stages:
- stage: Stage1
  displayName: Run newVersion.py stage1
  jobs:
    - job: Stage1Job1
      displayName: Run newVersion.py stage1
      pool:
        vmImage: ubuntu-latest
      steps:
        - checkout: self
        - checkout: mobile-sdk-ios
        - checkout: mobile-ui-react
        - checkout: mobile-samples

        - task: NodeTool@0
          displayName: Use Node 16.x
          inputs:
            versionSpec: 16.x

        # - script: $(Build.SourcesDirectory)/mobile-sdk-ios/newVersion.py stage1
        #   displayName: newVersion.py stage1
        - script: echo Stage1

# - stage: PublishMobileSDKCore
#   displayName: Publish mobile-sdk-core
#   dependsOn: 
#   jobs:
#     - template: cd-pipeline.yaml

- stage: Stage2
  displayName: Run newVersion.py stage2
  dependsOn: Stage1
  jobs:
    - job: Stage2Job1
      displayName: Run newVersion.py stage2
      pool:
        vmImage: ubuntu-latest
      steps:
        - checkout: self
        - checkout: mobile-sdk-ios
        - checkout: mobile-ui-react
        - checkout: mobile-samples

        - task: NodeTool@0
          displayName: Use Node 16.x
          inputs:
            versionSpec: 16.x

        # - script: $(Build.SourcesDirectory)/mobile-sdk-ios/newVersion.py stage2
        #   displayName: newVersion.py stage2
        - script: echo Stage2

# - stage: PublishMobileUIReact
#   displayName: Publish mobile-ui-react
#   dependsOn: Stage2
#   jobs:
#     - template: build/cd-pipeline.yaml@mobile-ui-react

- stage: Stage3
  displayName: Run newVersion.py stage3
  dependsOn: Stage2
  jobs:
    - job: Stage3Job1
      displayName: Run newVersion.py stage3
      pool:
        vmImage: ubuntu-latest
      steps:
        - checkout: self
        - checkout: mobile-sdk-ios
        - checkout: mobile-ui-react
        - checkout: mobile-samples

        - task: NodeTool@0
          displayName: Use Node 16.x
          inputs:
            versionSpec: 16.x

        # - script: $(Build.SourcesDirectory)/mobile-sdk-ios/newVersion.py stage3
        #   displayName: newVersion.py stage3
        - script: echo Stage3
